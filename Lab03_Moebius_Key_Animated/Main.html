<html>
  <head>
    <title>Boid simulation</title>
  </head>

  <style>
  body {margin: 0;}
  canvas {width: 100%; height: 100%;}
  </style>

  <body>
	<link rel="shortcut icon" href="#">

   
    <style>
    			body {
    				font-family: Monospace;
    				background-color: #000;
    				color: #fff;
    				margin: 0px;
    				overflow: hidden;
    			}
    			#info {
    				position: absolute;
    				top: 10px;
    				width: 100%;
    				text-align: center;
    			}
    </style>

    <div id="info">
      <p>This is the first example using threeJS<br>
      left button to rotate the scene, scroll to zoom in/out</p>
    </div>

		<script type="importmap">
			{
				"imports": {
					"three": "./build/three.module.js"
				}
			}
		</script>
		
	<script type="module">

  import * as THREE from 'three';
	import { OrbitControls } from './build/controls/OrbitControls.js';
  import Boid from './boids.js';
  import BoidManager from './boidManager.js';

    //create the scene
    var scene = new THREE.Scene( );
    var ratio = window.innerWidth/window.innerHeight;
    var camera = new THREE.PerspectiveCamera(45,ratio,0.1,1000);

    //set the camera position
    camera.position.set(0,0,15);
	  camera.lookAt(0,0,1);

    //create the webgl renderer
    var renderer = new THREE.WebGLRenderer( );

    //set the size of the rendering window
    renderer.setSize(window.innerWidth,window.innerHeight);

    //add the renderer to the current document
    document.body.appendChild(renderer.domElement );

  //////////////
	//   Boids  //
	//////////////
  
  // Create boid manager
  //these paramters can be changed
  const numberOfBoids = 50;
    const obstacles = [];
    const velocity = new THREE.Vector3();
    const maxSpeed = 1;
    const maxForce = 0.1;
    const searchRadius = 3;
    const lightPoint = new THREE.Vector3(0, 0, 0);
    const lightAttraction = 0.1;
    const spawnRadius = 10;
    const boidManager = new BoidManager(numberOfBoids, obstacles, velocity, maxSpeed, maxForce, searchRadius, lightPoint, lightAttraction, spawnRadius, scene);


  //////////////
	// CONTROLS //
	//////////////

  var controls = new OrbitControls( camera, renderer.domElement );

  var reverse=false;

  //final update loop
  var MyUpdateLoop = function ()
  {
    boidManager.update();
    renderer.render(scene,camera);
    controls.update();
    requestAnimationFrame(MyUpdateLoop);

  };
  requestAnimationFrame(MyUpdateLoop);

  
    function handleKeyDown(event) {
  
    }

  //add keyboard listener
  window.addEventListener('keydown', handleKeyDown, false);

  //this fucntion is called when the window is resized
  var MyResize = function ( )
  {
    var width = window.innerWidth;
    var height = window.innerHeight;
    renderer.setSize(width,height);
    camera.aspect = width/height;
    camera.updateProjectionMatrix();
    renderer.render(scene,camera);
  };

  //link the resize of the window to the update of the camera
  window.addEventListener( 'resize', MyResize);
    </script>
  </body>
</html>
